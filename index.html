<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Property Quotation – Final</title>
<style>
  :root{
    --bg:#f6f9fc;
    --card:rgba(255,255,255,0.78);
    --ink:#0b2239;
    --muted:#5a6b7b;
    --blue:#1e5aa6;
    --blue-ink:#134d89;
    --accent:#e9f2ff;
    --line:#e7eef6;
    --shadow:0 8px 24px rgba(16,38,60,.08);
    --radius:14px;
    --gap:12px;
    --label:12.5px;
    --value:13.25px;
    --h:14.5px;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:linear-gradient(180deg,#ffffff 0%, #f3f7fb 100%);color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  .page{max-width:980px;margin:0 auto;padding:16px 12px 80px}
  header.hero{
    position:sticky;top:0;z-index:5;backdrop-filter:saturate(180%) blur(10px);
    background:linear-gradient(180deg,rgba(255,255,255,.85),rgba(255,255,255,.65));
    border-bottom:1px solid var(--line);
  }
  .hero .wrap{display:flex;align-items:center;gap:12px;padding:10px 6px}
  .brand{
    width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,#5ea9ff,#2f6de8);
    box-shadow:0 6px 16px rgba(47,109,232,.25);flex:none;
  }
  .title h1{font-size:16px;margin:0;color:var(--blue-ink);letter-spacing:.2px}
  .title small{display:block;color:var(--muted);font-size:12px}
  .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:var(--gap)}
  @media (max-width:560px){.grid-2{grid-template-columns:1fr}}
  .card{
    background:var(--card);
    border:1px solid rgba(13,36,59,.06);
    border-radius:var(--radius);box-shadow:var(--shadow);
    padding:12px;backdrop-filter:blur(10px);
  }
  .card + .card{margin-top:12px}
  .card h3{
    margin:0 0 10px 0;
    font-size:var(--h);letter-spacing:.3px;
    color:var(--blue-ink);
    padding:8px 10px;border-radius:10px;
    background:linear-gradient(180deg,#f5f9ff,#eef4ff);
    border:1px solid #dbe7fb;
  }
  .field{display:flex;flex-direction:column;gap:6px}
  label{font-size:var(--label);color:var(--muted)}
  input,select{
    width:100%;padding:10px 10px;border-radius:10px;
    border:1px solid var(--line);background:#fff;outline:none;
    font-size:13px;color:var(--ink);
  }
  input[disabled], .hint{background:#f7f9fc;color:#98a7b6}
  .segment{display:flex;gap:6px;flex-wrap:wrap}
  .segment input{display:none}
  .segment label{
    padding:8px 10px;border:1px solid var(--line);border-radius:10px;cursor:pointer;
    background:#fff;font-size:12.5px;color:var(--ink)
  }
  .segment input:checked + label{
    background:linear-gradient(180deg,#eaf3ff,#dfeaff);
    color:var(--blue-ink);border-color:#cfe0ff;font-weight:600;
  }
  .actions{display:flex;gap:8px;justify-content:flex-end;margin:12px 0}
  .btn{
    padding:10px 14px;border-radius:10px;border:1px solid #cfe0ff;
    background:linear-gradient(180deg,#e8f1ff,#dbe8ff);
    color:var(--blue-ink);font-weight:600;cursor:pointer;
  }
  .btn.secondary{background:#fff;border-color:var(--line);color:var(--ink)}
  .btn.warn{background:#fff3f3;border-color:#ffdede;color:#8a1d1d}
  /* SUMMARY */
  #summary{display:none;margin-top:8px}
  .summary-header{display:flex;justify-content:space-between;align-items:center;margin:8px 2px 12px}
  .summary-header .date{font-size:12px;color:var(--muted)}
  .kpi-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  @media(max-width:560px){.kpi-grid{grid-template-columns:1fr}}
  .row{display:flex;justify-content:space-between;gap:8px;padding:6px 10px;border:1px dashed #e7eef6;border-radius:10px;background:#fff}
  .row + .row{margin-top:6px}
  .row .label{font-size:12px;color:#567;letter-spacing:.2px}
  .row .val{font-size:13px;font-weight:600;color:#153e63}
  .hl .label, .hl .val{color:#0f4e8f;font-weight:700}
  .caps{letter-spacing:.4px;font-weight:700;color:#0f4e8f}
  .note{font-size:12px;color:#98a7b6;font-style:italic;margin-top:8px}
  /* PRINT */
  @media print{
    header.hero, #inputs, .actions, .btn{display:none !important}
    body{background:#fff}
    .page{padding:0}
    #summary{display:block !important}
  }
</style>
</head>
<body>
<header class="hero">
  <div class="wrap">
    <div class="brand"></div>
    <div class="title">
      <h1>Property Quotation</h1>
      <small>Modern brochure • compact mobile layout</small>
    </div>
  </div>
</header>

<div class="page">

  <!-- INPUT AREA -->
  <section id="inputs">
    <div class="card">
      <h3>PROJECT DETAILS</h3>
      <div class="grid-2">
        <div class="field"><label>Project</label><input id="projName" placeholder="e.g., Prime Residences"/></div>
        <div class="field"><label>Tower / Phase</label><input id="projPhase" placeholder="e.g., Tower B"/></div>
        <div class="field"><label>Unit Type</label><input id="unitType" placeholder="e.g., 1BR"/></div>
        <div class="field"><label>Unit / Block / Lot #</label><input id="unitNo" placeholder="e.g., 15-08"/></div>
        <div class="field"><label>Area (sqm)</label><input id="area" type="number" step="0.01" placeholder="e.g., 32.50"/></div>
        <div class="field"><label>View</label><input id="view" placeholder="e.g., City view"/></div>
      </div>
      <div class="field" style="margin-top:8px">
        <label style="margin-bottom:6px">Payment Term Option</label>
        <div class="segment">
          <input type="radio" name="pt" id="pt_spot" checked><label for="pt_spot">Spot DP (Cash)</label>
          <input type="radio" name="pt" id="pt_split"><label for="pt_split">Split (Spot + Monthly)</label>
          <input type="radio" name="pt" id="pt_spread"><label for="pt_spread">Spread DP (Preselling)</label>
        </div>
      </div>
    </div>

    <div class="card">
      <h3>PRICING &amp; DISCOUNTS</h3>
      <div class="grid-2">
        <div class="field"><label>List Price</label><input id="listPrice" placeholder="e.g., 6,500,000"/></div>
        <div class="field"><label>Standard Discount (% or amount)</label><input id="discStd" placeholder="e.g., 5% or 100000"/></div>
        <div class="field"><label>Special Discount (% or amount)</label><input id="discSpec" placeholder="e.g., 2% or 50000"/></div>
        <div class="field"><label>Additional Discount (% or amount)</label><input id="discAdd" placeholder="e.g., 1% or 30000"/></div>
        <div class="field"><label>Rebate (% or amount)</label><input id="discReb" placeholder="e.g., 1% or 20000"/></div>
        <div class="field"><label>Other Charges (optional)</label><input id="otherCharges" placeholder="leave blank if none"/></div>
        <div class="field"><label>VAT</label><input class="hint" id="vatTop" placeholder="Auto-computed in Summary" disabled/></div>
      </div>
    </div>

    <div class="card">
      <h3>PAYMENT TERM DETAILS</h3>
      <div class="grid-2">
        <div class="field only-spot only-split"><label>Downpayment %</label><input id="dpPct" placeholder="e.g., 5%"/></div>
        <div class="field"><label>Reservation Fee</label><input id="rf" placeholder="e.g., 25,000"/></div>

        <div class="field only-split only-spread"><label>DP Equity %</label><input id="dpEqPct" placeholder="e.g., 15%"/></div>
        <div class="field only-split only-spread"><label>No. of Months</label><input id="months" type="number" step="1" placeholder="e.g., 24"/></div>
      </div>
      <div class="note">Net Downpayment, Monthly Amortization &amp; Remaining Balance are computed in the summary.</div>
    </div>

    <div class="card">
      <h3>BANK INTEREST RATE</h3>
      <div class="grid-2">
        <div class="field"><label>Annual Interest %</label><input id="interest" placeholder="e.g., 7%"/></div>
      </div>
    </div>

    <div class="card">
      <h3>PROPERTY CONSULTANT</h3>
      <div class="grid-2">
        <div class="field"><label>Name</label><input id="agentName" placeholder=""/></div>
        <div class="field"><label>Mobile No.</label><input id="agentPhone" placeholder=""/></div>
        <div class="field"><label>Position</label><input id="agentRole" placeholder=""/></div>
        <div class="field"><label>Generated Date</label><input id="genDate" type="date"/></div>
      </div>
    </div>

    <div class="actions">
      <button class="btn" id="computeBtn">Compute</button>
      <button class="btn secondary" id="resetBtn" type="button">Reset</button>
    </div>
  </section>

  <!-- SUMMARY AREA -->
  <section id="summary">
    <div class="summary-header">
      <div class="caps">PROPERTY QUOTATION SUMMARY</div>
      <div class="date" id="summaryDate"></div>
    </div>

    <div class="kpi-grid">
      <!-- Project Details Card -->
      <div class="card">
        <h3>PROJECT DETAILS</h3>
        <div class="row"><div class="label">Project</div><div class="val" id="s_projName"></div></div>
        <div class="row"><div class="label">Tower / Phase</div><div class="val" id="s_projPhase"></div></div>
        <div class="row"><div class="label">Unit Type</div><div class="val" id="s_unitType"></div></div>
        <div class="row"><div class="label">Unit / Block / Lot #</div><div class="val" id="s_unitNo"></div></div>
        <div class="row"><div class="label">Area (sqm)</div><div class="val" id="s_area"></div></div>
        <div class="row"><div class="label">View</div><div class="val" id="s_view"></div></div>
      </div>

      <!-- Quotation Summary Card -->
      <div class="card" id="cardQuote">
        <h3>QUOTATION SUMMARY</h3>
        <div class="row"><div class="label">List Price</div><div class="val" id="q_list"></div></div>
        <div class="row hl" id="row_dstd"><div class="label">Standard Discount</div><div class="val" id="q_dstd"></div></div>
        <div class="row hl" id="row_dspc"><div class="label">Special Discount</div><div class="val" id="q_dspc"></div></div>
        <div class="row hl" id="row_dadd"><div class="label">Additional Discount</div><div class="val" id="q_dadd"></div></div>
        <div class="row hl" id="row_dreb"><div class="label">Rebate</div><div class="val" id="q_dreb"></div></div>
        <div class="row"><div class="label">Net List Price</div><div class="val" id="q_nlp"></div></div>
        <div class="row" id="row_oc"><div class="label">Other Charges</div><div class="val" id="q_oc"></div></div>
        <div class="row" id="row_vat"><div class="label" id="q_vat_label">VAT (12%)</div><div class="val" id="q_vat"></div></div>
        <div class="row hl"><div class="label">TOTAL AMOUNT PAYABLE</div><div class="val" id="q_tap"></div></div>
      </div>

      <!-- Payment Term Summary Card -->
      <div class="card" id="cardPT">
        <h3>PAYMENT TERM DETAILS</h3>
        <div class="row hl" id="row_dp"><div class="label">Downpayment</div><div class="val" id="pt_dp"></div></div>
        <div class="row hl" id="row_rf"><div class="label">Reservation Fee</div><div class="val" id="pt_rf"></div></div>
        <div class="row hl" id="row_ndp"><div class="label">Net Downpayment</div><div class="val" id="pt_ndp"></div></div>
        <div class="row" id="row_dpeq"><div class="label">Downpayment (Equity)</div><div class="val" id="pt_dpeq"></div></div>
        <div class="row" id="row_mo"><div class="label">No. of Months</div><div class="val" id="pt_mo"></div></div>
        <div class="row hl" id="row_mam"><div class="label">Monthly Amortization</div><div class="val" id="pt_mam"></div></div>
        <div class="row" id="row_rb"><div class="label">Remaining Balance</div><div class="val" id="pt_rb"></div></div>
      </div>

      <!-- Bank Financing Card -->
      <div class="card" id="cardBank">
        <h3>BANK FINANCING</h3>
        <div class="row"><div class="label">Interest (annual)</div><div class="val" id="b_int"></div></div>
        <div class="row"><div class="label">Loanable Amount</div><div class="val" id="b_loan"></div></div>
        <div class="row"><div class="label">5 yrs Est. Monthly</div><div class="val" id="b_5"></div></div>
        <div class="row"><div class="label">10 yrs Est. Monthly</div><div class="val" id="b_10"></div></div>
        <div class="row"><div class="label">15 yrs Est. Monthly</div><div class="val" id="b_15"></div></div>
        <div class="row"><div class="label">20 yrs Est. Monthly</div><div class="val" id="b_20"></div></div>
        <div class="note">This computation is for presentation purposes only and may change without prior notice.</div>
      </div>

      <!-- Agent Details -->
      <div class="card">
        <h3>PROPERTY CONSULTANT</h3>
        <div class="row"><div class="label">Name</div><div class="val" id="a_name"></div></div>
        <div class="row"><div class="label">Mobile No.</div><div class="val" id="a_phone"></div></div>
        <div class="row"><div class="label">Position</div><div class="val" id="a_role"></div></div>
      </div>
    </div>

    <div class="actions">
      <button class="btn secondary" id="backBtn" type="button">Back / Edit</button>
      <button class="btn" id="pdfBtn" type="button">Save as PDF</button>
    </div>
  </section>
</div>

<script>
// ---------- helpers ----------
const $ = sel => document.querySelector(sel);
const fmtStrict = (num) => {
  if (isNaN(num) || !isFinite(num)) return '—';
  // format without rounding fractional part (keep as-is)
  const s = String(num);
  if (!s.includes('.')){
    return Number(s).toLocaleString('en-US');
  } else {
    const [i,f] = s.split('.');
    return Number(i).toLocaleString('en-US') + '.' + f.replace(/0+$/,'');
  }
};
const clean = (v) => {
  if (!v) return 0;
  if (typeof v === 'number') return v;
  v = String(v).trim();
  if (v === '') return 0;
  // percent will be handled elsewhere
  v = v.replace(/[₱,a-zA-Z\s]/g,'');
  const parsed = parseFloat(v);
  return isNaN(parsed) ? 0 : parsed;
};
const toPercent = (txt) => {
  if (!txt) return null;
  const m = String(txt).match(/(-?\d+(\.\d+)?)\s*%/);
  return m ? parseFloat(m[1]) : null;
};
const percOrAmt = (txt, base) => {
  if (!txt || String(txt).trim()==='') return 0;
  const p = toPercent(txt);
  if (p!==null) return base * (p/100);
  return clean(txt);
};
const show = el => el.style.display='';
const hide = el => el.style.display='none';

// toggle fields based on payment option
function applyPTVisibility(){
  const isSpot  = $('#pt_spot').checked;
  const isSplit = $('#pt_split').checked;
  const isSpread= $('#pt_spread').checked;
  document.querySelectorAll('.only-spot').forEach(x => x.style.display = (isSpot||isSplit)?'':'none');
  document.querySelectorAll('.only-split').forEach(x => x.style.display = isSplit?'':'none');
  document.querySelectorAll('.only-spread').forEach(x => x.style.display = isSpread?'':'none');
}
applyPTVisibility();
document.querySelectorAll('input[name="pt"]').forEach(r=>r.addEventListener('change',applyPTVisibility));

// ---------- compute ----------
function computeAll(){
  // date
  const dInput = $('#genDate').value;
  const today = dInput ? new Date(dInput) : new Date();
  $('#summaryDate').textContent = today.toLocaleDateString();

  // project details
  $('#s_projName').textContent = $('#projName').value || '';
  $('#s_projPhase').textContent = $('#projPhase').value || '';
  $('#s_unitType').textContent = $('#unitType').value || '';
  $('#s_unitNo').textContent   = $('#unitNo').value   || '';
  $('#s_area').textContent     = $('#area').value     || '';
  $('#s_view').textContent     = $('#view').value     || '';

  // pricing & discounts (successive)
  let list = clean($('#listPrice').value);
  let sub = list;
  const dStdAmt = percOrAmt($('#discStd').value, sub); sub -= dStdAmt;
  const dSpcAmt = percOrAmt($('#discSpec').value, sub); sub -= dSpcAmt;
  const dAddAmt = percOrAmt($('#discAdd').value, sub); sub -= dAddAmt;
  const dRebAmt = percOrAmt($('#discReb').value, sub); sub -= dRebAmt;
  const nlp = sub;

  const oc = clean($('#otherCharges').value);
  const taxableBase = nlp + oc;

  let vatAmt = 0, vatLbl = 'VAT (12%)';
  if (taxableBase > 3600000){
    vatAmt = taxableBase * 0.12;
  }else{
    vatAmt = 0; vatLbl = 'VAT (0% – Exempt)';
  }
  const tap = taxableBase + vatAmt;

  // summary fill
  $('#q_list').textContent = '₱ ' + fmtStrict(list);
  // toggle rows for zero discounts
  const setRow = (id, val) => {
    const row = document.getElementById(id);
    if (Math.abs(val) > 0){ show(row); } else { hide(row); }
  };
  $('#q_dstd').textContent = '– ₱ ' + fmtStrict(dStdAmt); setRow('row_dstd', dStdAmt);
  $('#q_dspc').textContent = '– ₱ ' + fmtStrict(dSpcAmt); setRow('row_dspc', dSpcAmt);
  $('#q_dadd').textContent = '– ₱ ' + fmtStrict(dAddAmt); setRow('row_dadd', dAddAmt);
  $('#q_dreb').textContent = '– ₱ ' + fmtStrict(dRebAmt); setRow('row_dreb', dRebAmt);

  $('#q_nlp').textContent  = '₱ ' + fmtStrict(nlp);
  $('#q_oc').textContent   = '₱ ' + fmtStrict(oc);
  setRow('row_oc', oc);

  $('#q_vat').textContent  = '₱ ' + fmtStrict(vatAmt);
  $('#q_vat_label').textContent = vatLbl;
  $('#q_tap').textContent  = '₱ ' + fmtStrict(tap);

  // payment terms
  const isSpot  = $('#pt_spot').checked;
  const isSplit = $('#pt_split').checked;
  const isSpread= $('#pt_spread').checked;

  const rf = clean($('#rf').value);
  let dpPct = toPercent($('#dpPct').value);
  let dpEqPct = toPercent($('#dpEqPct').value);
  const months = parseInt($('#months').value||'0',10);

  if (dpPct===null) dpPct = 0;
  if (dpEqPct===null) dpEqPct = 0;

  let dpAmt=0, netDP=0, dpeqAmt=0, mam=0, rb=0;

  if (isSpot){
    dpAmt = tap * (dpPct/100);
    netDP = dpAmt - rf;
    dpeqAmt = 0; mam = 0; rb = tap - netDP;
    hide($('#row_dpeq')); hide($('#row_mo')); hide($('#row_mam'));
    show($('#row_dp')); show($('#row_rf')); show($('#row_ndp')); show($('#row_rb'));
  }
  if (isSplit){
    dpAmt = tap * (dpPct/100);
    netDP = dpAmt - rf;
    dpeqAmt = tap * (dpEqPct/100);
    mam = months>0 ? (dpeqAmt / months) : 0;
    rb = tap - netDP - dpeqAmt;
    show($('#row_dpeq')); show($('#row_mo')); show($('#row_mam')); show($('#row_dp')); show($('#row_rf')); show($('#row_ndp')); show($('#row_rb'));
  }
  if (isSpread){
    dpAmt = 0; // no spot
    netDP = 0;
    dpeqAmt = tap * (dpEqPct/100);
    mam = months>0 ? (dpeqAmt / months) : 0;
    rb = tap - dpeqAmt;
    hide($('#row_dp')); show($('#row_rf')); hide($('#row_ndp')); show($('#row_dpeq')); show($('#row_mo')); show($('#row_mam')); show($('#row_rb'));
  }

  $('#pt_dp').textContent   = dpAmt? ('₱ ' + fmtStrict(dpAmt)) : '—';
  $('#pt_rf').textContent   = rf? ('₱ ' + fmtStrict(rf)) : '—';
  $('#pt_ndp').textContent  = netDP? ('₱ ' + fmtStrict(netDP)) : '—';
  $('#pt_dpeq').textContent = dpeqAmt? ('₱ ' + fmtStrict(dpeqAmt)) : '—';
  $('#pt_mo').textContent   = months || (months===0? '—':'');
  $('#pt_mam').textContent  = mam? ('₱ ' + fmtStrict(mam)) : '—';
  $('#pt_rb').textContent   = '₱ ' + fmtStrict(rb);

  // disappear empty rows in quote & PT
  const maybeHide = (rowId, val) => {
    const row = document.getElementById(rowId);
    if (!row) return;
    if (val===0 || val===null || val==='' || val==='—'){ hide(row); } else { show(row); }
  };
  maybeHide('row_rf', rf? ('₱ ' + fmtStrict(rf)) : '—');
  maybeHide('row_ndp', netDP? ('₱ ' + fmtStrict(netDP)) : '—');
  maybeHide('row_dpeq', dpeqAmt? ('₱ ' + fmtStrict(dpeqAmt)) : '—');
  maybeHide('row_mo', months);
  maybeHide('row_mam', mam? ('₱ ' + fmtStrict(mam)) : '—');

  // Bank
  const interestTxt = $('#interest').value;
  const intP = toPercent(interestTxt) ?? clean(interestTxt); // accept "7" or "7%"
  const loan = rb; // loanable = remaining balance
  const rate = (intP||0)/100/12;

  function pmt(principal, r, n){
    if (n<=0) return 0;
    if (r===0) return principal / n;
    return principal * (r * Math.pow(1+r, n)) / (Math.pow(1+r, n)-1);
  }
  const m5  = pmt(loan, rate, 5*12);
  const m10 = pmt(loan, rate,10*12);
  const m15 = pmt(loan, rate,15*12);
  const m20 = pmt(loan, rate,20*12);

  $('#b_int').textContent  = (intP? intP : 0) + '%';
  $('#b_loan').textContent = '₱ ' + fmtStrict(loan);
  $('#b_5').textContent    = '₱ ' + fmtStrict(m5);
  $('#b_10').textContent   = '₱ ' + fmtStrict(m10);
  $('#b_15').textContent   = '₱ ' + fmtStrict(m15);
  $('#b_20').textContent   = '₱ ' + fmtStrict(m20);

  // agent
  $('#a_name').textContent  = $('#agentName').value || '';
  $('#a_phone').textContent = $('#agentPhone').value || '';
  $('#a_role').textContent  = $('#agentRole').value || '';

  // swap views
  $('#inputs').style.display='none';
  $('#summary').style.display='block';
}

// buttons
$('#computeBtn').addEventListener('click', computeAll);
$('#backBtn').addEventListener('click', ()=>{
  $('#summary').style.display='none';
  $('#inputs').style.display='block';
});
$('#pdfBtn').addEventListener('click', ()=>window.print());
$('#resetBtn').addEventListener('click', ()=>{ location.reload(); });
</script>
</body>
</html>
