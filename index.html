<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Property Quotation Calculator</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f3f6fb;
    --panel:#ffffff;
    --ink:#122039;
    --muted:#6b7a99;
    --line:#e6ebf5;
    --pill1:#2563eb;
    --pill2:#22d3ee;
    --shadow:0 10px 28px rgba(18,32,57,.08);
    --radius:16px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:linear-gradient(145deg,#eef4ff 0%,#f7fbff 35%,#eef5ff 100%);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;color:var(--ink)}
  .wrap{max-width:920px;margin:18px auto 90px;padding:0 14px}
  .hdr{display:flex;align-items:center;gap:10px;margin:4px 0 14px}
  .brand{font-weight:800;letter-spacing:.2px}
  .card{background:rgba(255,255,255,.72);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px;margin:12px 0}
  .title{display:flex;align-items:center;gap:10px;margin:0 0 10px}
  .pill{height:30px;display:inline-flex;align-items:center;border-radius:999px;padding:0 12px;color:#fff;background:linear-gradient(90deg,var(--pill1),var(--pill2));font-weight:800;font-size:14px}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  @media(max-width:720px){.grid{grid-template-columns:1fr}}
  label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
  input{width:100%;padding:10px;border-radius:12px;border:1px solid var(--line);background:#fff;font-size:14px}
  input::placeholder{color:#b7c3d9}
  .options{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
  .chip{border:1px solid var(--line);border-radius:999px;background:#fff;padding:8px 12px;font-weight:700;font-size:13px;color:var(--ink);cursor:pointer}
  .chip.active{background:linear-gradient(90deg,var(--pill1),var(--pill2));color:#fff;border-color:transparent}
  .btnbar{display:flex;flex-wrap:wrap;gap:10px;margin:10px 0 6px}
  .btn{border:0;border-radius:12px;padding:10px 14px;font-weight:800;color:#fff;background:linear-gradient(90deg,var(--pill1),var(--pill2));cursor:pointer}
  table{width:100%;border-collapse:separate;border-spacing:0 6px}
  th,td{padding:8px 10px;font-size:13px}
  th{background:#f6f9ff;text-align:left;color:#2b3f6e}
  td.amount, th.amount{text-align:right}
  .threecol td:first-child{width:18%;color:#5b6c90}
  .note{font-size:12px;color:#7e8fb3;margin-top:8px}
  .divider{height:6px}
  .compact .grid div{margin-bottom:2px}
  .muted{color:#7e8fb3}
</style>
</head>
<body>
<div class="wrap">
  <div class="hdr"><div class="brand">Property Quotation Calculator</div></div>

  <!-- Project Details -->
  <section class="card">
    <div class="title"><span class="pill">Project Details</span></div>
    <div class="grid">
      <div><label>Project Name</label><input id="projName" placeholder="South Residences"></div>
      <div><label>Unit Area (sqm)</label><input id="unitArea" placeholder="36.53"></div>
      <div><label>View</label><input id="unitView" placeholder="Mall View"></div>
      <div><label>Unit</label><input id="unitNo" placeholder="B030916"></div>
    </div>
  </section>

  <!-- Pricing & Discounts -->
  <section class="card">
    <div class="title"><span class="pill">Pricing & Discounts</span></div>
    <div class="grid">
      <div><label>List Price (₱)</label><input id="listPrice" type="number" placeholder="5532000"></div>
    </div>
    <div class="grid">
      <div><label>Standard Discount (% or ₱)</label><input id="discStd" placeholder="21% or 100000"></div>
      <div><label>Special Discount (% or ₱)</label><input id="discSp" placeholder="5% or 50000"></div>
      <div><label>Additional Discount (% or ₱)</label><input id="discAdd" placeholder="1% or 20000"></div>
      <div><label>Rebate Discount (% or ₱)</label><input id="discReb" placeholder="1.5% or 30000"></div>
    </div>
    <div class="divider"></div>
    <div class="grid">
      <div><label>Other Charges (%)</label><input id="otherPct" type="number" placeholder="8.5"></div>
      <div><label>VAT (%) <span class="muted">(auto 0% if NLP ≤ 3.6M)</span></label><input id="vatPct" type="number" placeholder="12"></div>
    </div>
  </section>

  <!-- Payment Term Details -->
  <section class="card">
    <div class="title"><span class="pill">Payment Term Details</span></div>
    <div class="options">
      <button class="chip active" data-opt="spread">Spread DP (Preselling)</button>
      <button class="chip" data-opt="spot">Spot DP (Cash)</button>
      <button class="chip" data-opt="split">Split (Spot + Monthly)</button>
    </div>
    <div class="grid" style="margin-top:8px">
      <!-- Shared -->
      <div id="row-dpPct"><label id="lbl-dpPct">Downpayment % of TAP</label><input id="dpPct" type="number" placeholder="5"></div>
      <div id="row-res"><label>Reservation Fee (₱)</label><input id="resFee" type="number" placeholder="30000"></div>
      <div id="row-net"><label id="lbl-net">Net Downpayment (₱)</label><input id="netDp" disabled></div>

      <!-- Spread specific -->
      <div id="row-months"><label id="lbl-months">No. of Months</label><input id="months" type="number" placeholder="12"></div>
      <div id="row-monthly"><label id="lbl-monthly">Monthly Amortization (₱)</label><input id="equityMonthly" disabled></div>

      <!-- Split specific -->
      <div id="row-spotPct" style="display:none"><label>Spot DP % of TAP</label><input id="spotPct" type="number" placeholder="5"></div>
      <div id="row-equityPct" style="display:none"><label>Equity DP % of TAP</label><input id="equityPct" type="number" placeholder="5"></div>
    </div>
  </section>

  <!-- Buttons before summary -->
  <div class="btnbar">
    <button class="btn" id="computeBtn">Compute</button>
    <button class="btn" id="resetBtn">Reset</button>
    <button class="btn" id="pdfBtn">Save as PDF</button>
  </div>

  <!-- Quotation Summary -->
  <section class="card">
    <div class="title"><span class="pill">Quotation Summary</span></div>
    <table class="threecol">
      <tbody id="sumBody"></tbody>
    </table>
  </section>

  <!-- Bank Financing (separate row/section) -->
  <section class="card">
    <div class="title"><span class="pill">Bank Financing</span></div>
    <div class="grid">
      <div><label>Interest Rate (annual %)</label><input id="rate" type="number" placeholder="5.5"></div>
    </div>
    <table>
      <tbody id="bankBody"></tbody>
    </table>
    <div class="note" id="rateNote"></div>
  </section>

  <!-- Property Consultant (compact) -->
  <section class="card compact">
    <div class="title"><span class="pill">Property Consultant</span></div>
    <div class="grid">
      <div><label>Name</label><input id="pcName" placeholder="Juan Dela Cruz"></div>
      <div><label>Mobile No.</label><input id="pcMobile" placeholder="0917-xxx-xxxx"></div>
    </div>
    <div class="grid">
      <div><label>Position</label><input id="pcPos" placeholder="Property Consultant"></div>
      <div><label>Date</label><input id="pcDate" placeholder="Auto" disabled></div>
    </div>
  </section>
</div>

<script>
// helpers
const peso = n => (isNaN(n)?0:n).toLocaleString('en-PH',{minimumFractionDigits:2, maximumFractionDigits:2});
function parseDiscount(input, base){
  if(!input) return 0;
  input = (''+input).trim();
  if(input.endsWith('%')) return base * (parseFloat(input)/100);
  const val = parseFloat(input.replace(/,/g,''));
  return isNaN(val) ? 0 : val;
}

let payOpt = 'spread';
const chips = document.querySelectorAll('.chip');
chips.forEach(ch => ch.onclick = () => {
  chips.forEach(c => c.classList.remove('active'));
  ch.classList.add('active');
  payOpt = ch.dataset.opt;
  toggleFields();
});

function toggleFields(){
  const rowDpPct = document.getElementById('row-dpPct');
  const rowRes = document.getElementById('row-res');
  const rowNet = document.getElementById('row-net');
  const rowMonths = document.getElementById('row-months');
  const rowMonthly = document.getElementById('row-monthly');
  const rowSpotPct = document.getElementById('row-spotPct');
  const rowEqPct = document.getElementById('row-equityPct');
  const lblDpPct = document.getElementById('lbl-dpPct');
  const lblNet = document.getElementById('lbl-net');
  const lblMonths = document.getElementById('lbl-months');
  const lblMonthly = document.getElementById('lbl-monthly');

  if(payOpt==='spread'){
    rowDpPct.style.display = 'block';
    lblDpPct.textContent = 'Downpayment % of TAP';
    rowRes.style.display = 'block';
    rowNet.style.display = 'block';
    rowMonths.style.display = 'block';
    rowMonthly.style.display = 'block';
    rowSpotPct.style.display = 'none';
    rowEqPct.style.display = 'none';
    lblNet.textContent = 'Net Downpayment (₱)';
    lblMonths.textContent = 'No. of Months';
    lblMonthly.textContent = 'Monthly Amortization (₱)';
  } else if(payOpt==='spot'){
    rowDpPct.style.display = 'block';
    lblDpPct.textContent = 'Downpayment % of TAP';
    rowRes.style.display = 'block';
    rowNet.style.display = 'block';
    rowMonths.style.display = 'none';
    rowMonthly.style.display = 'none';
    rowSpotPct.style.display = 'none';
    rowEqPct.style.display = 'none';
    lblNet.textContent = 'Net Downpayment (₱)';
  } else if(payOpt==='split'){
    rowDpPct.style.display = 'none';
    rowRes.style.display = 'block';
    rowNet.style.display = 'block';
    rowMonths.style.display = 'block';
    rowMonthly.style.display = 'block';
    rowSpotPct.style.display = 'block';
    rowEqPct.style.display = 'block';
    lblNet.textContent = 'Net Downpayment (Spot)';
    lblMonths.textContent = 'Equity: No. of Months';
    lblMonthly.textContent = 'Monthly Amortization (Equity)';
  }
}
toggleFields();

function computeAll(){
  // Inputs
  const list = +document.getElementById('listPrice').value || 0;
  const dStd = parseDiscount(document.getElementById('discStd').value, list);
  const dSp  = parseDiscount(document.getElementById('discSp').value,  list);
  const dAdd = parseDiscount(document.getElementById('discAdd').value, list);
  const dReb = parseDiscount(document.getElementById('discReb').value, list);
  const totalDisc = dStd + dSp + dAdd + dReb;
  const nlp = list - totalDisc;

  const otherPct = (+document.getElementById('otherPct').value || 0);
  const other = nlp * otherPct/100;

  const vatPctInput = +document.getElementById('vatPct').value || 0;
  const vat = (nlp > 3600000) ? (nlp * vatPctInput/100) : 0; // auto 0 if NLP ≤ 3.6M
  const tap = nlp + other + vat;

  const rf = +document.getElementById('resFee').value || 0;
  const months = +document.getElementById('months').value || 0;
  const rate = +document.getElementById('rate').value || 0;

  // Payment computations
  let remaining = tap;
  let summaryRows = [];

  const p = (v)=> isFinite(v) ? v : 0;
  const fmtPct = (x)=> (x===null || x===undefined) ? '' : (Number(x).toFixed(2)+'%');

  // Pricing rows
  summaryRows.push(['', 'List Price', p(list)]);
  if(totalDisc) summaryRows.push(['', 'Total Discounts', -p(totalDisc)]);
  summaryRows.push(['', 'Net List Price', p(nlp)]);
  if(other) summaryRows.push([fmtPct(otherPct), 'Other Charges', p(other)]);
  summaryRows.push([ (nlp>3600000) ? (Number(vatPctInput).toFixed(2)+'%') : 'VAT Exempt', 'VAT', p(vat) ]);
  summaryRows.push(['', 'Total Amount Payable (TAP)', p(tap)]);

  if(payOpt==='spread'){
    const dpPctVal = (+document.getElementById('dpPct').value || 0);
    const dp = tap * dpPctVal/100;
    const net = dp - rf;
    const monthly = months ? net/months : 0;
    document.getElementById('netDp').value = (net || net===0) ? (p(net)).toLocaleString('en-PH',{minimumFractionDigits:2,maximumFractionDigits:2}) : '';
    document.getElementById('equityMonthly').value = months ? (p(monthly)).toLocaleString('en-PH',{minimumFractionDigits:2,maximumFractionDigits:2}) : '';

    if(dp) summaryRows.push([fmtPct(dpPctVal), 'Downpayment', -p(dp)]);
    if(rf) summaryRows.push(['', 'Reservation Fee', -p(rf)]);
    if(net || net===0) summaryRows.push(['', 'Net Downpayment', -p(net)]);
    if(months && monthly) summaryRows.push(['', `Monthly Amortization (${months} mos)`, -p(monthly)]);

    remaining = tap - dp;

  } else if(payOpt==='spot'){
    const dpPctVal = (+document.getElementById('dpPct').value || 0);
    const dp = tap * dpPctVal/100;
    const net = dp - rf;
    document.getElementById('netDp').value = (net || net===0) ? (p(net)).toLocaleString('en-PH',{minimumFractionDigits:2,maximumFractionDigits:2}) : '';
    document.getElementById('equityMonthly').value = '';

    if(dp) summaryRows.push([fmtPct(dpPctVal), 'Downpayment', -p(dp)]);
    if(rf) summaryRows.push(['', 'Reservation Fee', -p(rf)]);
    if(net || net===0) summaryRows.push(['', 'Net Downpayment', -p(net)]);

    remaining = tap - dp;

  } else if(payOpt==='split'){
    const spotPct = (+document.getElementById('spotPct').value || 0);
    const eqPct = (+document.getElementById('equityPct').value || 0);
    const spot = tap * spotPct/100;
    const netSpot = spot - rf;
    const eq = tap * eqPct/100;
    const monthly = months ? eq/months : 0;

    document.getElementById('netDp').value = (netSpot || netSpot===0) ? (p(netSpot)).toLocaleString('en-PH',{minimumFractionDigits:2,maximumFractionDigits:2}) : '';
    document.getElementById('equityMonthly').value = months ? (p(monthly)).toLocaleString('en-PH',{minimumFractionDigits:2,maximumFractionDigits:2}) : '';

    if(spot) summaryRows.push([fmtPct(spotPct), 'Downpayment (Spot)', -p(spot)]);
    if(rf) summaryRows.push(['', 'Reservation Fee', -p(rf)]);
    if(netSpot || netSpot===0) summaryRows.push(['', 'Net Downpayment (Spot)', -p(netSpot)]);
    if(eq) summaryRows.push([fmtPct(eqPct), 'Downpayment (Equity)', -p(eq)]);
    if(months && monthly) summaryRows.push(['', `Monthly Amortization (Equity, ${months} mos)`, -p(monthly)]);

    remaining = tap - (spot + eq);
  }

  // Remaining balance (always)
  summaryRows.push(['', 'Remaining Balance', p(remaining)]);

  // Render summary
  const tbody = document.getElementById('sumBody');
  tbody.innerHTML = '';
  summaryRows.forEach(([pct,label,amount])=>{
    if(label==='Total Discounts' && amount===0) return; // hide zero total discounts
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${pct||''}</td><td>${label}</td><td class="amount">${peso(amount)}</td>`;
    tbody.appendChild(tr);
  });

  // Bank amortization (loanable = remaining)
  const bankBody = document.getElementById('bankBody');
  bankBody.innerHTML = '';
  const addBank = (k,v)=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${k}</td><td class="amount">${peso(v)}</td>`; bankBody.appendChild(tr); };
  const amort = (P,rAnnual,years)=>{
    const i = rAnnual/100/12;
    const n = years*12;
    if(!i) return P/n;
    const f = Math.pow(1+i,n);
    return P*(i*f)/(f-1);
  };
  addBank('Loanable Amount (at the bank)', remaining);
  [5,10,15,20].forEach(y=> addBank(`${y} yrs Est. Monthly Amortization`, amort(remaining, rate, y)) );
  document.getElementById('rateNote').textContent = `Based on ${rate}% annual interest.`;

  // stamp date
  document.getElementById('pcDate').value = new Date().toLocaleDateString();
}

document.getElementById('computeBtn').onclick = computeAll;
document.getElementById('resetBtn').onclick = () => location.reload();
document.getElementById('pdfBtn').onclick = () => window.print();

</script>
</body>
</html>
