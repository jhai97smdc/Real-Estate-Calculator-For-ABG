<!DOCTYPE html>

<html lang="en">
<head>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&amp;display=swap" rel="stylesheet"/>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Property Quotation â€” Final</title>
<style>
  :root{
    --blue:#1a73e8;
    --blue-strong:#0F5FD7;
    --text:#0f172a;
    --muted:#5b6b86;
    --card-bg: rgba(255,255,255,0.68);
    --frost-blur: 14px;
    --ring: rgba(26,115,232,.18);
    --shadow: 0 8px 30px rgba(16,24,40,.08);
    --radius: 14px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
    color:var(--text);
    background:#fff;
    background-image:
      radial-gradient(1400px 400px at -10% -20%, rgba(26,115,232,.08), transparent 60%),
      radial-gradient(900px 300px at 120% 10%, rgba(26,115,232,.06), transparent 55%);
  }
  .container{
    max-width:980px;
    margin:24px auto 96px;
    padding:0 14px;
  }
  .brand{
    display:flex;justify-content:space-between;align-items:center;
    margin-bottom:10px;
  }
  .brand h1{
    font-size:18px;
    letter-spacing:.4px;
    font-weight:700;
    margin:0;
    color:#0f172a;
  }
  .date-stamp{font-size:12px;color:var(--muted)}

  /* Cards */
  .card{
    background:var(--card-bg);
    backdrop-filter: blur(var(--frost-blur));
    border:1px solid rgba(15,23,42,.06);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    margin:10px 0 14px;
    overflow:hidden;
  }
  .card .head{
    background:linear-gradient(135deg, rgba(26,115,232,.92), rgba(26,115,232,.78));
    color:#fff; padding:9px 12px;
    font-size:.78rem; letter-spacing:.08em; font-weight:700;
  }
  .card .content{ padding:12px }
  .grid-2{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:10px 12px;
  }
  @media (max-width:640px){
    .grid-2{ grid-template-columns: 1fr 1fr; }
  }
  label{
    font-size:.76rem; color:var(--muted); display:block; margin-bottom:6px;
    letter-spacing:.2px;
  }
  input[type="text"], input[type="number"]{
    width:100%; padding:10px 10px;
    border:1px solid rgba(15,23,42,.12); border-radius:10px;
    background:rgba(255,255,255,.86);
    outline:none; font-size:.9rem;
  }
  input[type="text"]:focus, input[type="number"]:focus{
    border-color:var(--blue); box-shadow:0 0 0 3px var(--ring);
  }
  .row{display:grid; grid-template-columns:1fr 1fr; gap:12px}
  .row-tight{display:grid; grid-template-columns:1fr 1fr; gap:8px}
  .row-single{display:grid; grid-template-columns:1fr; gap:10px}

  /* Payment term buttons */
  .seg{
    display:flex; gap:8px; flex-wrap:wrap;
  }
  .seg button{
    flex:1 1 auto;
    padding:10px 12px; border-radius:999px; border:1px solid rgba(15,23,42,.14);
    background:#fff; cursor:pointer; font-weight:600; font-size:.9rem;
  }
  .seg button.active{
    background:rgba(26,115,232,.12);
    color:var(--blue-strong);
    border-color:rgba(26,115,232,.35);
  }

  /* Action buttons */
  .actions{
    display:flex; gap:10px; justify-content:flex-end; align-items:center; margin-top:6px;
  }
  .btn{
    appearance:none; border:none; border-radius:10px; padding:10px 14px; font-weight:700; cursor:pointer;
  }
  .btn-blue{ background:var(--blue); color:#fff; }
  .btn-ghost{ background:transparent; color:var(--blue-strong); border:1px solid rgba(26,115,232,.35) }
  .btn:active{ transform:translateY(1px) }

  /* Summary (compact) */
  .summary .content{ padding:10px }
  .kv{ display:grid; grid-template-columns: 1.3fr 1fr; gap:6px 10px; align-items:center; }
  .kv .k{ font-size:.78rem; color:#334155 }
  .kv .v{ justify-self:end; font-weight:700; font-size:.88rem }
  .kv .k.em{ color:var(--blue-strong); font-weight:800 }
  .kv .v.em{ color:var(--blue-strong) }
  .divider{ height:10px }
  .muted{ font-size:.75rem; color:#64748b }
  .note{ font-style:italic; font-size:.75rem; color:#64748b; margin-top:8px }

  /* Visibility control */
  #summaryView{ display:none }
  .hidden{ display:none !important }

  /* Small typography tweak for full-summary fit */
  .summary .head{ font-size:.72rem; padding:8px 10px }
  .summary .kv .k{ font-size:.72rem }
  .summary .kv .v{ font-size:.82rem }

  
  
/* Columns inside summary */
  .summary-grid{
    display:grid;
    grid-template-columns:1fr;
    gap:12px;
  }

  /* Make cards a touch thinner */
  .card.compact .content{ padding:10px }

/* --- Quotation Summary Alignment Fix --- */
.kv-row { display: contents;  font-size:1.05rem;}
#sumKV .k, #sumKV .v {
  font-size: .82rem;
  line-height: 1.25;
}
#sumKV .em { font-weight: 800; }
#sumKV .v { justify-self: end; }


/* Ensure divider spans both columns so it doesn't shift next items */
#sumKV .divider, .kv .divider { grid-column: 1 / -1; height: 10px; }

/* --- Final Fix: Consistent alignment for Quotation Summary --- */
#sumKV .k, #sumKV .v {
  font-size: .82rem;
  line-height: 1.25;
}
#sumKV .em { font-weight: 800; }
#sumKV .v { justify-self: end; }
/* Divider spans both columns */
#sumKV .divider { grid-column: 1 / -1; height: 10px; }


/* --- Results Section Polish & Transition --- */
#summaryView {
  display: none;
  opacity: 0;
  transform: translateY(10px);
  transition: opacity 0.6s ease, transform 0.6s ease;
}
#summaryView.show {
  display: block;
  opacity: 1;
  transform: translateY(0);
}
#summaryView .card {
  margin-bottom: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
}
#summaryView .head {
  font-weight: 600;
  font-size: 1rem;
}


/* --- Screenshot Mode --- */
.screenshot-mode .btn,
.screenshot-mode .actions {
  display: none !important;
}
.screenshot-mode {
  background: #fff;
  padding: 10px;
}


/* --- Compact & Highlighted Results --- */
#summaryView .card {
  margin-bottom: 10px;
  padding: 8px 10px;
}
#summaryView .head {
  font-size: 0.95rem;
  padding: 6px 8px;
}
#summaryView .kv-row .k,
#summaryView .kv-row .v {
  font-size: 0.9rem;
  line-height: 1.3;
}
/* Important rows bold + slightly larger */
#summaryView .kv-row.discount .k,
#summaryView .kv-row.discount .v,
#summaryView .kv-row.total .k,
#summaryView .kv-row.total .v,
#summaryView .kv-row.downpayment .k,
#summaryView .kv-row.downpayment .v,
#summaryView .kv-row.netdownpayment .k,
#summaryView .kv-row.netdownpayment .v,
#summaryView .kv-row.reservation .k,
#summaryView .kv-row.reservation .v,
#summaryView .kv-row.amortization .k,
#summaryView .kv-row.amortization .v,
#summaryView .kv-row.remaining .k,
#summaryView .kv-row.remaining .v {
  font-weight: 600;
  font-size: 1.05rem;
}
/* Extra bottom spacing for consultant card */
#summaryView .consultant-card {
  margin-bottom: 30px;
}


/* --- Modern Elegant Theme --- */
body {
  font-family: 'Poppins', Arial, sans-serif;
  background-color: #f9fafb;
  margin: 0;
  padding: 0;
}
.card {
  background: #fff;
  border-radius: 8px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.08);
  margin: 16px 0;
  padding: 12px 14px;
}
.head {
  background: linear-gradient(90deg, #1e3a8a, #2563eb);
  color: #fff;
  font-size: 1rem;
  font-weight: 600;
  padding: 10px 12px;
  border-radius: 6px 6px 0 0;
  margin: -12px -14px 12px -14px;
}
input[type="text"], input[type="number"], input[type="tel"] {
  width: 100%;
  padding: 10px;
  border: 1px solid #d1d5db;
  border-radius: 6px;
  font-family: 'Poppins', Arial, sans-serif;
  transition: all 0.2s ease;
}
input[type="text"]:focus, input[type="number"]:focus, input[type="tel"]:focus {
  border-color: #2563eb;
  box-shadow: 0 0 0 3px rgba(37,99,235,0.2);
  outline: none;
}
.btn {
  display: inline-block;
  padding: 10px 16px;
  background: linear-gradient(90deg, #2563eb, #1e40af);
  color: #fff;
  font-weight: 600;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  text-align: center;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 6px rgba(0,0,0,0.15);
}
.actions {
  display: flex;
  gap: 10px;
  margin-top: 12px;
}
.actions .btn {
  flex: 1;
}
/* Results compact rules */
#summaryView .kv-row .k,
#summaryView .kv-row .v {
  font-size: 0.9rem;
  line-height: 1.3;
}
#summaryView .kv-row.discount .k,
#summaryView .kv-row.discount .v,
#summaryView .kv-row.total .k,
#summaryView .kv-row.total .v,
#summaryView .kv-row.downpayment .k,
#summaryView .kv-row.downpayment .v,
#summaryView .kv-row.netdownpayment .k,
#summaryView .kv-row.netdownpayment .v,
#summaryView .kv-row.reservation .k,
#summaryView .kv-row.reservation .v,
#summaryView .kv-row.amortization .k,
#summaryView .kv-row.amortization .v,
#summaryView .kv-row.remaining .k,
#summaryView .kv-row.remaining .v {
  font-weight: 600;
  font-size: 1.05rem;
}





/* --- Premium Gradient Frosted Glass Inputs with Glow --- */
@keyframes glowPulse {
  0% { box-shadow: inset 0 1px 2px rgba(0,0,0,0.1), 0 0 0 2px rgba(37,99,235,0.25); }
  50% { box-shadow: inset 0 1px 2px rgba(0,0,0,0.1), 0 0 0 4px rgba(37,99,235,0.35); }
  100% { box-shadow: inset 0 1px 2px rgba(0,0,0,0.1), 0 0 0 2px rgba(37,99,235,0.25); }
}
input[type="text"], input[type="number"], input[type="tel"] {
  width: 100%;
  padding: 12px;
  border: 1px solid rgba(0, 0, 0, 0.1);
  border-radius: 12px;
  background: linear-gradient(145deg, rgba(255,255,255,0.9), rgba(255,255,255,0.75));
  backdrop-filter: blur(6px);
  box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);
  font-family: 'Poppins', Arial, sans-serif;
  transition: all 0.3s ease;
}
input[type="text"]:focus, input[type="number"]:focus, input[type="tel"]:focus {
  border-color: #2563eb;
  background: linear-gradient(145deg, rgba(255,255,255,0.95), rgba(255,255,255,0.85));
  backdrop-filter: blur(10px);
  outline: none;
  animation: glowPulse 1.5s infinite;
}


/* --- Frosted Glass Results --- */
#summaryView {
  background: linear-gradient(145deg, rgba(255,255,255,0.9), rgba(255,255,255,0.75));
  backdrop-filter: blur(6px);
  border-radius: 12px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  padding: 12px;
}


/* --- Compact & Even Card Layout --- */
.card {
  margin: 10px 0;
  padding: 8px;
  border-radius: 10px;
}
.head {
  font-size: 0.9rem;
  padding: 6px 8px;
}
input[type="text"], input[type="number"], input[type="tel"] {
  padding: 8px 10px;
  font-size: 0.9rem;
}
.btn {
  padding: 8px 12px;
  font-size: 0.9rem;
}
#summaryView {
  padding: 10px;
}


/* --- Compact Consultant Card --- */
#consultantCard {
  font-size: 0.9rem;
  padding: 8px !important;
}

</style>
<style>
.summary-row {
    display: flex;
    justify-content: space-between;
    padding: 4px 0;
}
.summary-label {
    flex: 1;
    text-align: left;
}
.summary-value {
    flex: 1;
    text-align: right;
}
.hidden {
    display: none;
}
</style></head>
<body>
<div class="container">
<div class="brand">
<h1>Property Quotation</h1>
<div class="date-stamp">Generated: <span id="genDate">â€”</span></div>
</div>
<!-- INPUT VIEW -->
<div id="inputView">
<!-- Project Details -->
<div class="card">
<div class="head">PROJECT DETAILS</div>
<div class="content grid-2">
<div>
<label>Project</label>
<input id="pd_project" placeholder="e.g., Gold Residences" type="text"/>
</div>
<div>
<label>Tower / Phase</label>
<input id="pd_tower" placeholder="e.g., Tower 1" type="text"/>
</div>
<div>
<label>Unit Type</label>
<input id="pd_unittype" placeholder="e.g., 1BR w/ Balcony" type="text"/>
</div>
<div>
<label>Unit No.</label>
<input id="pd_unitno" placeholder="e.g., 21-B" type="text"/>
</div>
<div>
<label>Floor</label>
<input id="pd_floor" placeholder="e.g., 21st" type="text"/>
</div>
<div>
<label>View</label>
<input id="pd_view" placeholder="e.g., Amenity / City View" type="text"/>
</div>
</div>
</div>
<!-- Pricing & Discounts -->
<div class="card">
<div class="head">PRICING &amp; DISCOUNTS</div>
<div class="content">
<div class="grid-2">
<div>
<label>List Price (â‚±)</label>
<input id="price_list" placeholder="e.g., 5800000" type="text"/>
</div>
<div>
<label>Standard Discount (â‚± or %)</label>
<input id="disc_std" placeholder="e.g., 10% or 150000" type="text"/>
</div>
<div>
<label>Special Discount (â‚± or %)</label>
<input id="disc_special" placeholder="e.g., 3% or 50000" type="text"/>
</div>
<div>
<label>Additional Discount (â‚± or %)</label>
<input id="disc_add" placeholder="e.g., 2% or 25000" type="text"/>
</div>
<div>
<label>Rebate (â‚± or %)</label>
<input id="disc_rebate" placeholder="e.g., 1% or 10000" type="text"/>
</div>
<div>
<label>Other Charges (â‚± or %)</label>
<input id="other_charges" placeholder="Enter %" type="text"/>
</div>
</div>
<div class="muted" style="margin-top:6px">VAT follows the â‚±3.6M rule and will be auto-computed in the summary.</div>
</div>
</div>
<!-- Payment Term Details -->
<div class="card">
<div class="head">PAYMENT TERM DETAILS</div>
<div class="content">
<div class="seg" id="termButtons">
<button class="active" data-term="spot" type="button">Spot DP (Cash)</button>
<button data-term="spread" type="button">Spread DP (Preselling)</button>
<button data-term="split" type="button">Split DP</button>
</div>
<!-- Spot -->
<div class="row" id="fields_spot" style="margin-top:10px">
<div>
<label>Downpayment %</label>
<input id="spot_dp_pct" placeholder="e.g., 20" type="text"/>
</div>
<div>
<label>Reservation Fee (â‚±)</label>
<input id="spot_rf" placeholder="e.g., 25000" type="text"/>
</div>
<div>
<label>No. of Months (optional)</label>
<input id="spot_months" placeholder="e.g., 0" type="text"/>
</div>
</div>
<!-- Spread -->
<div class="row hidden" id="fields_spread" style="margin-top:10px">
<div>
<label>Downpayment % (Equity)</label>
<input id="spread_dp_pct" placeholder="e.g., 10" type="text"/>
</div>
<div>
<label>Reservation Fee (â‚±)</label>
<input id="spread_rf" placeholder="e.g., 25000" type="text"/>
</div>
<div>
<label>No. of Months</label>
<input id="spread_months" placeholder="e.g., 12" type="text"/>
</div>
</div>
<!-- Split -->
<div class="row hidden" id="fields_split" style="margin-top:10px">
<div>
<label>Downpayment %</label>
<input id="split_dp_pct" placeholder="e.g., 10" type="text"/>
</div>
<div>
<label>Reservation Fee (â‚±)</label>
<input id="split_rf" placeholder="e.g., 25000" type="text"/>
</div>
<div>
<label>DP Equity %</label>
<input id="split_equity_pct" placeholder="e.g., 10" type="text"/>
</div>
<div>
<label>No. of Months</label>
<input id="split_months" placeholder="e.g., 12" type="text"/>
</div>
</div>
</div>
</div>
<!-- Bank Financing (interest input only here) -->
<div class="card">
<div class="head">BANK FINANCING (INPUT)</div>
<div class="content row-single">
<div class="row-tight">
<div>
<label>Interest Rate % (Annual)</label>
<input id="bank_interest" placeholder="e.g., 7.5" type="text"/>
</div>
</div>
<div class="muted">Amortizations for 5 / 10 / 15 / 20 years are computed from the Remaining Balance after clicking <strong>Compute</strong>.</div>
</div>
</div>
<!-- Agent / Property Consultant -->
<div class="card">
<div class="head">PROPERTY CONSULTANT</div>
<div class="content grid-2">
<div>
<label>Name</label>
<input id="agent_name" placeholder="e.g., Juan Dela Cruz" type="text"/>
</div>
<div>
<label>Mobile No.</label>
<input id="agent_mobile" placeholder="e.g., 0917 123 4567" type="text"/>
</div>
<div>
<label>Position</label>
<input id="agent_pos" placeholder="e.g., Property Consultant" type="text"/>
</div>
</div>
</div>
<div class="actions">
<button class="btn btn-blue" id="btnCompute">Compute</button>
</div>
</div>
<!-- SUMMARY VIEW -->
<div id="summaryView" style="display:none">
<div class="actions" style="justify-content:flex-start;margin-bottom:6px">
<button class="btn btn-ghost" id="btnBack">Back / Edit</button>
<button class="btn" id="btnScreenshot" style="margin-left:8px">Screenshot Mode</button>
</div>
<div class="summary-grid summary">
<!-- Project Details (read-only) -->
<div class="card compact">
<div class="head">PROJECT DETAILS</div>
<div class="content">
<div class="kv">
<div class="k">Project</div><div class="v" id="s_pd_project">â€”</div>
<div class="k">Tower / Phase</div><div class="v" id="s_pd_tower">â€”</div>
<div class="k">Unit Type</div><div class="v" id="s_pd_unittype">â€”</div>
<div class="k">Unit No.</div><div class="v" id="s_pd_unitno">â€”</div>
<div class="k">Floor</div><div class="v" id="s_pd_floor">â€”</div>
<div class="k">View</div><div class="v" id="s_pd_view">â€”</div>
</div>
</div>
</div>
<!-- Quotation Summary -->
<div class="card compact" id="cardSummary">
<div class="head">QUOTATION SUMMARY</div>
<div class="content">
<div class="kv" id="sumKV">
<div class="kv-row">
<div class="k">List Price</div><div class="v" id="v_listprice">â€”</div>
</div>
<div class="kv-row" id="row_std">
<div class="k em">Standard Discount</div><div class="v em" id="row_std_v"></div>
</div>
<div class="kv-row" id="row_special">
<div class="k em">Special Discount</div><div class="v em" id="row_special_v"></div>
</div>
<div class="kv-row" id="row_add">
<div class="k em">Additional Discount</div><div class="v em" id="row_add_v"></div>
</div>
<div class="kv-row" id="row_rebate">
<div class="k em">Rebate</div><div class="v em" id="row_rebate_v"></div>
</div>
<div class="kv-row">
<div class="k">Net List Price</div><div class="v" id="v_netlist">â€”</div>
</div>
<div class="divider"></div>
<div class="kv-row">
<div class="k">Other Charges</div><div class="v" id="row_other_v"></div>
</div>
<div class="kv-row">
<div class="k" id="row_vat_k">VAT</div><div class="v" id="row_vat_v"></div>
</div>
<div class="divider"></div>
<div class="kv-row">
<div class="k em">TOTAL AMOUNT PAYABLE</div><div class="v em" id="v_tap">â€”</div>
</div>
</div>
</div>
</div>
</div>
<!-- Payment Term (dynamic per option) -->
<div class="card compact" id="cardPT">
<div class="head">PAYMENT TERM DETAILS</div>
<div class="content">
<div class="kv" id="ptKV">
<!-- rows injected -->
</div>
</div>
</div>
<!-- Bank Financing -->
<div class="card compact" id="cardBank">
<div class="head">BANK FINANCING</div>
<div class="content">
<div class="kv" id="bankKV">
<div class="k">Interest (Annual)</div><div class="v" id="v_interest">â€”</div>
<div class="k">5 yrs â€“ Est. Monthly</div><div class="v" id="v_b5">â€”</div>
<div class="k">10 yrs â€“ Est. Monthly</div><div class="v" id="v_b10">â€”</div>
<div class="k">15 yrs â€“ Est. Monthly</div><div class="v" id="v_b15">â€”</div>
<div class="k">20 yrs â€“ Est. Monthly</div><div class="v" id="v_b20">â€”</div>
</div>
<div class="note">This computation is for presentation purposes only and may change without prior notice.</div>
</div>
</div>
<!-- Agent -->
<div class="card compact">
<div class="head">PROPERTY CONSULTANT</div>
<div class="content">
<div class="kv">
<div class="k">Name</div><div class="v" id="s_agent_name">â€”</div>
<div class="k">Mobile No.</div><div class="v" id="s_agent_mobile">â€”</div>
<div class="k">Position</div><div class="v" id="s_agent_pos">â€”</div>
</div>
</div>
</div>
</div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    document.querySelectorAll(".summary-row").forEach(row => {
        let valueCell = row.querySelector(".summary-value");
        if (valueCell && (valueCell.textContent.trim() === "" || valueCell.textContent.trim() === "â‚±0.00")) {
            row.classList.add("hidden");
        }
    });
});
</script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  const exempt = ['price_list', 'disc_std', 'disc_special', 'disc_add', 'disc_rebate', 'other_charges', 'spot_rf', 'spread_rf', 'split_rf', 'bank_interest', 'agent_mobile'];
  document.querySelectorAll("input").forEach(el => {
    el.addEventListener("input", function(e) {
      if (exempt.includes(el.id)) return; // skip formatting for exempted IDs
    });
  });
});
</script>
<script>
// Safe input formatting: only format a small set of numeric fields on blur; do not modify value while typing.
(function(){
  const numericIds = ['price_list','other_charges','spot_rf','spread_rf','split_rf',
                      'spot_months','spread_months','split_months','bank_interest'];
  function cleanForParse(v){
    if(v === null || v === undefined) return '';
    return String(v).replace(/[,â‚±\s]/g, '').replace(/[^\d.]/g, '');
  }
  function addCommasToInteger(str){
    return String(str).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
  }
  numericIds.forEach(id => {
    const el = document.getElementById(id);
    if(!el) return;
    // On focus: remove commas to make editing easier
    el.addEventListener('focus', function(e){
      this.dataset.prev = this.value;
      this.value = String(this.value).replace(/,/g,'');
    });
    // On blur: clean non-numeric (except dot), then format integer part with commas
    el.addEventListener('blur', function(e){
      const raw = this.value || '';
      const cleaned = cleanForParse(raw);
      if(cleaned === '') { this.value = ''; return; }
      if(cleaned.indexOf('.') > -1){
        const parts = cleaned.split('.');
        const intPart = parts[0] || '0';
        const decPart = parts[1] || '';
        this.value = addCommasToInteger(intPart) + (decPart ? '.' + decPart : '');
      } else {
        this.value = addCommasToInteger(cleaned);
      }
    });
    // Intentionally do NOT modify value on input to avoid blocking typing
  });
})();
</script>
<script defer="">
// Safe input formatting: numeric formatting only for certain fields; allow free typing in Project Details & Consultant fields.
(function(){
  const numericIds = ['price_list','other_charges','spot_rf','spread_rf','split_rf',
                      'spot_months','spread_months','split_months','bank_interest'];
  const freeIds = ['pd_project','pd_tower','pd_unittype','pd_unitno','pd_floor','pd_view',
                   'agent_name','agent_mobile','agent_pos'];
  function cleanForParse(v){
    if(v === null || v === undefined) return '';
    return String(v).replace(/[,â‚±\s]/g, '').replace(/[^\d.]/g, '');
  }
  function addCommasToInteger(str){
    return String(str).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
  }
  numericIds.forEach(id => {
    const el = document.getElementById(id);
    if(!el) return;
    el.addEventListener('focus', function(e){
      this.value = String(this.value).replace(/,/g,'');
    });
    el.addEventListener('blur', function(e){
      const raw = this.value || '';
      const cleaned = cleanForParse(raw);
      if(cleaned === '') { this.value = ''; return; }
      if(cleaned.indexOf('.') > -1){
        const parts = cleaned.split('.');
        const intPart = parts[0] || '0';
        const decPart = parts[1] || '';
        this.value = addCommasToInteger(intPart) + (decPart ? '.' + decPart : '');
      } else {
        this.value = addCommasToInteger(cleaned);
      }
    });
  });
  // freeIds: no formatting, just allow free typing, so no event listeners
})();
</script>

<script>
(function(){
  function parseNumber(v){
    if(v===undefined || v===null) return 0;
    v = String(v).replace(/,/g,'').trim();
    if(v==='') return 0;
    var n = parseFloat(v);
    return isNaN(n) ? 0 : n;
  }
  function fmt(n){
    if(!isFinite(n)) return 'â€”';
    var x = Math.round(n*100)/100;
    return 'â‚±' + x.toLocaleString(undefined,{minimumFractionDigits:2, maximumFractionDigits:2});
  }
  function parseDiscount(val, base){
    if(!val) return {amount:0, percent:null};
    val = String(val).trim();
    if(val.includes('%')){
      var p = parseFloat(val);
      if(!isNaN(p)) return {amount: base*(p/100), percent:p};
    }
    var f = parseFloat(val.replace(/,/g,''));
    if(!isNaN(f)) return {amount: f, percent:null};
    return {amount:0, percent:null};
  }
  function showRowAmount(rowId, valueId, amt, labelSmall, percent){
    var row = document.getElementById(rowId);
    if(!row) return;
    if(amt>0){
      row.style.display='grid';
      var vEl = document.getElementById(valueId);
      if(vEl) vEl.textContent = fmt(amt);
      var kEl = row.querySelector('.k');
      if(kEl && labelSmall){
        kEl.innerHTML = (percent?('<small>(' + percent + '%)</small> '):'') + labelSmall;
      }
    }else{
      row.style.display='none';
    }
  }
  function setText(id, text){
    var el = document.getElementById(id);
    if(el) el.textContent = text;
  }
  function amortize(P, annualRate, years){
    var n = years*12;
    if(!P || P<=0 || !annualRate || annualRate<=0 || !n) return 0;
    var i = (annualRate/100)/12;
    var pow = Math.pow(1+i, n);
    return P*(i*pow)/(pow-1);
  }
  function activeTerm(){
    var btn = document.querySelector('#termButtons button.active');
    return btn ? btn.getAttribute('data-term') : 'spot';
  }

  function compute(){
    try{
      setText('s_pd_project', document.getElementById('pd_project').value || 'â€”');
      setText('s_pd_tower', document.getElementById('pd_tower').value || 'â€”');
      setText('s_pd_unittype', document.getElementById('pd_unittype').value || 'â€”');
      setText('s_pd_unitno', document.getElementById('pd_unitno').value || 'â€”');
      setText('s_pd_floor', document.getElementById('pd_floor').value || 'â€”');
      setText('s_pd_view', document.getElementById('pd_view').value || 'â€”');

      var listPrice = parseNumber(document.getElementById('price_list').value);
      var oChargesPct = parseNumber(document.getElementById('other_charges').value);
      var dStd = parseDiscount(document.getElementById('disc_std').value, listPrice);
      var dSpec = parseDiscount(document.getElementById('disc_special').value, listPrice);
      var dAdd = parseDiscount(document.getElementById('disc_add').value, listPrice);
      var dReb = parseDiscount(document.getElementById('disc_rebate').value, listPrice);

      var totalDisc = dStd.amount + dSpec.amount + dAdd.amount + dReb.amount;
      var netList = Math.max(0, listPrice - totalDisc);

      // Other Charges strictly percent
      var otherAmt = oChargesPct>0 ? netList*(oChargesPct/100) : 0;

      var vatPercent = null, vatAmount = 0;
      var total = netList + otherAmt + vatAmount;

      setText('v_listprice', fmt(listPrice));
      showRowAmount('row_std', 'row_std_v', dStd.amount, 'Standard Discount', dStd.percent);
      showRowAmount('row_special', 'row_special_v', dSpec.amount, 'Special Discount', dSpec.percent);
      showRowAmount('row_add', 'row_add_v', dAdd.amount, 'Additional Discount', dAdd.percent);
      showRowAmount('row_rebate', 'row_rebate_v', dReb.amount, 'Rebate', dReb.percent);

      (function(){
        var row = document.getElementById('row_other_v');
        if(row){
          if(otherAmt>0){
            row.parentElement.style.display='grid';
            row.textContent = fmt(otherAmt);
            var labelK = row.parentElement.querySelector('.k');
            if(labelK){
              labelK.innerHTML = '<small>(' + oChargesPct + '%)</small> Other Charges';
            }
          }else{
            row.parentElement.style.display='none';
          }
        }
      })();

      setText('v_tap', fmt(total));

      var pt = document.getElementById('ptKV');
      if(pt){
        pt.innerHTML = '';
        var term = activeTerm();
        var dpPct=0, rf=0, months=0;
        if(term==='spot'){
          dpPct = parseNumber(document.getElementById('spot_dp_pct').value);
          rf = parseNumber(document.getElementById('spot_rf').value);
          months = parseNumber(document.getElementById('spot_months').value);
        }else if(term==='spread'){
          dpPct = parseNumber(document.getElementById('spread_dp_pct').value);
          rf = parseNumber(document.getElementById('spread_rf').value);
          months = parseNumber(document.getElementById('spread_months').value);
        }else{
          dpPct = parseNumber(document.getElementById('split_dp_pct').value);
          rf = parseNumber(document.getElementById('split_rf').value);
          months = parseNumber(document.getElementById('split_months').value);
        }

        var dpAmt = dpPct>0 ? total*(dpPct/100) : 0;
        var netDp = Math.max(0, dpAmt - rf);
        var equityMonthly = (months>0 && netDp>0) ? (netDp / months) : 0;
        var remain = Math.max(0, total - dpAmt);
        var remainPct = (dpPct>0 && dpPct<=100) ? (100 - dpPct) : null;

        function addKV(k, v, bold, smallPct){
          var kDiv = document.createElement('div');
          kDiv.className='k' + (bold?' em':'');
          kDiv.innerHTML = (smallPct?('<small>(' + smallPct + '%)</small> '):'') + k;
          var vDiv = document.createElement('div');
          vDiv.className='v' + (bold?' em':'');
          vDiv.textContent = v;
          pt.appendChild(kDiv); pt.appendChild(vDiv);
        }
        function addDivider(){
          var d = document.createElement('div');
          d.className='divider';
          d.style.gridColumn='1 / -1';
          pt.appendChild(d);
        }

        if(dpAmt>0) addKV('Downpayment', fmt(dpAmt), true, dpPct||null);
        if(rf>0) addKV('Reservation Fee', fmt(rf), false, null);
        if(netDp>0) addKV('Net Downpayment', fmt(netDp), true, null);
        if(netDp>0){
          addDivider();
          addKV('Downpayment (Equity)', fmt(netDp), true, dpPct||null);
          if(months>0) addKV('No. of Months', months+' months', false, null);
          if(equityMonthly>0) addKV('Monthly Amortization', fmt(equityMonthly), false, null);
          addDivider();
        }
        if(remain>0) addKV('Remaining Balance', fmt(remain), true, remainPct||null);

        var rate = parseNumber(document.getElementById('bank_interest').value);
        setText('v_interest', rate ? (rate+'%') : 'â€”');
        var b5 = amortize(remain, rate, 5);
        var b10 = amortize(remain, rate, 10);
        var b15 = amortize(remain, rate, 15);
        var b20 = amortize(remain, rate, 20);
        setText('v_b5', b5>0?fmt(b5):'â€”');
        setText('v_b10', b10>0?fmt(b10):'â€”');
        setText('v_b15', b15>0?fmt(b15):'â€”');
        setText('v_b20', b20>0?fmt(b20):'â€”');
      }

      var inputView = document.getElementById('inputView');
      var summaryView = document.getElementById('summaryView');
      if(inputView && summaryView){
        inputView.style.display='none';
        summaryView.style.display='block';
        window.scrollTo({top:0, behavior:'smooth'});
      }
    }catch(err){
      console.error(err);
      alert('There was an error while computing. Please review your inputs.');
    }
  }

  var btnCompute = document.getElementById('btnCompute');
  if(btnCompute) btnCompute.addEventListener('click', compute);

  var btnBack = document.getElementById('btnBack');
  if(btnBack) btnBack.addEventListener('click', function(){
    var inputView = document.getElementById('inputView');
    var summaryView = document.getElementById('summaryView');
    if(inputView && summaryView){
      summaryView.style.display='none';
      inputView.style.display='block';
      window.scrollTo({top:0, behavior:'smooth'});
    }
  });

  var termBtns = document.querySelectorAll('#termButtons button');
  termBtns.forEach(function(b){
    b.addEventListener('click', function(){
      termBtns.forEach(x=>x.classList.remove('active'));
      this.classList.add('active');
      var t = this.getAttribute('data-term');
      ['spot','spread','split'].forEach(function(name){
        var field = document.getElementById('fields_'+name);
        if(field) field.classList.toggle('hidden', name!==t);
      });
    });
  });
})(); 
</script>
</body>
</html>
