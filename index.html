<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Property Quotation – Mobile</title>
<style>
  :root{
    --bg:#ffffff;
    --glass: rgba(255,255,255,0.75);
    --blur: 8px;
    --ink:#0e1b2a;
    --muted:#6b7a90;
    --brand:#0e66ff;
    --brand-ink:#0a3da5;
    --accent:#e9f0ff;
    --outline:#e8edf5;
    --good:#16a34a;
    --danger:#ef4444;
    --shadow: 0 6px 22px rgba(16,34,65,.08);
    --radius:14px;
    --gap:14px;
    --input-h:38px;
    --card-pad:14px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background:
      radial-gradient(1200px 600px at 10% -10%, #f5f9ff 0%, transparent 60%),
      radial-gradient(900px 500px at 110% 10%, #f0f7ff 0%, transparent 60%),
      var(--bg);
    font: 500 14px/1.35 Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    color:var(--ink);
  }

  /* Layout */
  .wrap{max-width:880px;margin:24px auto;padding:14px}
  .titlebar{
    position:sticky; top:0; z-index:3;
    margin-bottom:14px; backdrop-filter:saturate(180%) blur(10px);
  }
  .brand{
    display:flex;align-items:center;justify-content:space-between;
    gap:10px;background:linear-gradient(135deg,#0f5df8,#3aa0ff);
    color:white;border-radius:16px;padding:14px 16px;box-shadow:var(--shadow);
  }
  .brand h1{font-size:16px;margin:0;letter-spacing:.2px}
  .brand small{opacity:.9}
  .grid{display:grid; gap:var(--gap)}
  /* two-column on mobile but airy */
  .grid-2{grid-template-columns:1fr 1fr}
  @media (max-width:560px){ .grid-2{grid-template-columns:1fr 1fr} }
  @media (max-width:420px){ .grid-2{grid-template-columns:1fr} }

  /* Cards */
  .card{
    background:var(--glass); backdrop-filter:blur(var(--blur));
    border:1px solid var(--outline); border-radius:var(--radius);
    box-shadow:var(--shadow); overflow:hidden;
  }
  .card .h{
    padding:10px 14px; background:linear-gradient(180deg,#eaf1ff, #e3ecff);
    color:#0b3d97; font-weight:700; font-size:13px; letter-spacing:.3px;
    border-bottom:1px solid var(--outline);
  }
  .card .b{padding:var(--card-pad)}

  /* Inputs */
  .row{display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:8px}
  .row.full{grid-template-columns:1fr}
  .field{
    display:flex; flex-direction:column; gap:6px;
  }
  label{font-size:12px;color:var(--muted)}
  input[type="text"],input[type="number"]{
    height:var(--input-h); width:100%; padding:0 10px;border-radius:10px;
    border:1px solid var(--outline); background:#fff;
    outline:none; box-shadow:0 2px 0 rgba(16,34,65,.02) inset;
  }
  input::placeholder{color:#b8c0d0}
  .hint{font-size:11px;color:#8a96ac}

  /* Payment term buttons */
  .pt-buttons{display:flex; gap:8px; flex-wrap:wrap}
  .pt-buttons button{
    border:1px solid var(--outline); background:#fff; color:var(--brand-ink);
    padding:8px 10px;border-radius:999px; cursor:pointer; font-weight:700;
  }
  .pt-buttons button.active{background:var(--brand);color:#fff;border-color:transparent}

  /* Action buttons */
  .actions{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; padding:10px 0 0}
  .btn{
    border:1px solid var(--outline); background:#fff; padding:10px 12px; border-radius:12px;
    cursor:pointer; font-weight:800; color:var(--brand-ink);
  }
  .btn.primary{background:var(--brand); color:#fff; border-color:transparent}
  .btn.ghost{background:transparent}
  .btn.warn{background:#fff; color:#b42318; border-color:#ffd1cf}

  /* Summary cards & grid */
  .summary-wrap{display:grid; gap:var(--gap)}
  .summary-grid{display:grid; grid-template-columns:1fr 1fr; gap:10px}
  @media (max-width:520px){ .summary-grid{grid-template-columns:1fr} }
  .kv{display:flex; align-items:center; justify-content:space-between; gap:10px; padding:8px 10px; border:1px dashed var(--outline); border-radius:10px; background:#fff}
  .kv b{color:#063e9b}
  .kv em{font-style:normal; color:var(--ink)}

  /* Hide sections when summarizing */
  .hide-on-summary{}
  .is-summary .hide-on-summary{display:none}
  .is-summary .summary-only{display:block}
  .summary-only{display:none}

  /* Disappearing rows */
  .row-hide{display:none}

  /* Helpers */
  .note{font-size:11px;color:#7b8aa8}

  /* Print only summary */
  @media print{
    body{background:white}
    .titlebar, .actions, .hide-on-summary{display:none!important}
    .card{box-shadow:none;border-color:#ddd}
  }
</style>
</head>
<body>
  <div class="wrap" id="app">
    <div class="titlebar">
      <div class="brand">
        <h1>PROPERTY QUOTATION (Mobile)</h1>
        <small>Elegant brochure layout · Frosted cards</small>
      </div>
    </div>

    <!-- PROJECT DETAILS -->
    <section class="card hide-on-summary">
      <div class="h">PROJECT DETAILS</div>
      <div class="b grid grid-2">
        <div class="field">
          <label>Project</label>
          <input id="pd_project" type="text" placeholder="e.g., Azure North"/>
        </div>
        <div class="field">
          <label>Location</label>
          <input id="pd_location" type="text" placeholder="e.g., San Fernando, Pampanga"/>
        </div>
        <div class="field">
          <label>Unit Type</label>
          <input id="pd_unit" type="text" placeholder="e.g., 1BR w/ Balcony"/>
        </div>
        <div class="field">
          <label>View</label>
          <input id="pd_view" type="text" placeholder="e.g., City / Amenity / Lagoon"/>
        </div>
        <div class="field">
          <label>Tower / Unit No.</label>
          <input id="pd_ref" type="text" placeholder="e.g., Tower 2 · 18F-12"/>
        </div>
        <div class="field">
          <label>Parking (optional)</label>
          <input id="pd_parking" type="text" placeholder="e.g., 1 Slot"/>
        </div>
      </div>
    </section>

    <!-- PAYMENT TERM OPTION BUTTONS -->
    <section class="card hide-on-summary">
      <div class="h">PAYMENT TERM OPTION</div>
      <div class="b">
        <div class="pt-buttons">
          <button type="button" class="pt active" data-mode="spot">Spot DP (Cash)</button>
          <button type="button" class="pt" data-mode="split">Split (Spot + Monthly)</button>
          <button type="button" class="pt" data-mode="spread">Spread DP (Preselling)</button>
        </div>
        <div class="note" style="margin-top:8px">Choose a term to reveal only the needed fields.</div>
      </div>
    </section>

    <!-- PRICING & DISCOUNTS -->
    <section class="card hide-on-summary">
      <div class="h">PRICING &amp; DISCOUNTS</div>
      <div class="b grid grid-2">
        <div class="field">
          <label>List Price (₱)</label>
          <input id="price_list" type="number" step="0.01" placeholder="e.g., 4500000"/>
        </div>

        <div></div>

        <div class="field">
          <label>Standard Discount (₱ or %)</label>
          <input id="disc1" type="text" placeholder="e.g., 5% or 50000"/>
        </div>
        <div class="field">
          <label>Special Discount (₱ or %)</label>
          <input id="disc2" type="text" placeholder="e.g., 3% or 25000"/>
        </div>
        <div class="field">
          <label>Additional Discount (₱ or %)</label>
          <input id="disc3" type="text" placeholder="e.g., 2% or 15000"/>
        </div>
        <div class="field">
          <label>Rebate (₱ or %)</label>
          <input id="disc4" type="text" placeholder="e.g., 1% or 8000"/>
        </div>

        <div class="field">
          <label>Other Charges (%)</label>
          <input id="other_pct" type="number" step="0.0001" placeholder="e.g., 3.5"/>
          <div class="hint">Computed from Net List Price</div>
        </div>
        <div class="field">
          <label>VAT (auto)</label>
          <input id="vat_info" type="text" disabled placeholder="Auto: 0 if ≤ ₱3.6M; else 12% of NLP"/>
        </div>
      </div>
    </section>

    <!-- PAYMENT TERM DETAILS (INPUTS) -->
    <section class="card hide-on-summary" id="termCard">
      <div class="h">PAYMENT TERM DETAILS</div>
      <div class="b grid grid-2">
        <div class="field term term-common term-spot term-split">
          <label>Downpayment % of TAP</label>
          <input id="dp_pct" type="number" step="0.0001" placeholder="e.g., 5"/>
        </div>
        <div class="field term term-common term-spot term-split term-spread">
          <label>Reservation Fee (₱)</label>
          <input id="rf_amt" type="number" step="0.01" placeholder="e.g., 50000"/>
        </div>

        <div class="field term term-split term-spread">
          <label>DP Equity % of TAP</label>
          <input id="eq_pct" type="number" step="0.0001" placeholder="e.g., 10"/>
        </div>
        <div class="field term term-split term-spread">
          <label>No. of Months (Equity)</label>
          <input id="eq_months" type="number" step="1" placeholder="e.g., 18"/>
        </div>
      </div>
    </section>

    <!-- BANK (INTEREST INPUT + ACTIONS) -->
    <section class="card hide-on-summary">
      <div class="h">BANK FINANCING – INPUT</div>
      <div class="b grid grid-2">
        <div class="field">
          <label>Bank Interest Rate (%)</label>
          <input id="bank_rate" type="number" step="0.0001" placeholder="e.g., 8.25"/>
        </div>
        <div class="field">
          <label>Years (shown in summary)</label>
          <input type="text" disabled value="5 · 10 · 15 · 20" />
        </div>
        <div class="actions" style="grid-column:1/-1; justify-content:flex-end">
          <button class="btn" id="btnReset" type="button">Reset</button>
          <button class="btn primary" id="btnCompute" type="button">Compute</button>
        </div>
        <div class="note" style="grid-column:1/-1">On Compute, inputs will hide; summary cards will remain for screenshot/PDF.</div>
      </div>
    </section>

    <!-- ===== SUMMARY VIEW (VISIBLE AFTER COMPUTE) ===== -->
    <section class="summary-only">
      <!-- PROJECT DETAILS (SUMMARY) -->
      <div class="card">
        <div class="h">PROJECT DETAILS</div>
        <div class="b summary-grid" id="sum_project">
          <!-- populated by JS -->
        </div>
      </div>

      <!-- QUOTATION SUMMARY -->
      <div class="card">
        <div class="h">QUOTATION SUMMARY</div>
        <div class="b summary-grid" id="sum_quote">
          <!-- populated by JS -->
        </div>
      </div>

      <!-- PAYMENT TERM SUMMARY -->
      <div class="card">
        <div class="h">PAYMENT TERM</div>
        <div class="b summary-grid" id="sum_term">
          <!-- populated by JS -->
        </div>
      </div>

      <!-- BANK SUMMARY -->
      <div class="card">
        <div class="h">BANK FINANCING</div>
        <div class="b summary-grid" id="sum_bank">
          <!-- populated by JS -->
        </div>
      </div>

      <!-- AGENT DETAILS -->
      <div class="card">
        <div class="h">PROPERTY CONSULTANT</div>
        <div class="b summary-grid" id="sum_agent">
          <!-- populated by JS -->
        </div>
      </div>

      <!-- SUMMARY ACTIONS -->
      <div class="actions" style="margin-top:6px">
        <button class="btn ghost" id="btnBack" type="button">Back / Edit</button>
        <button class="btn" id="btnPDF" type="button">Save as PDF</button>
      </div>
      <div class="note" style="margin-top:6px;font-style:italic">This computation is for presentation purposes only and may change without prior notice.</div>
    </section>

    <!-- AGENT (INPUTS) -->
    <section class="card hide-on-summary">
      <div class="h">PROPERTY CONSULTANT</div>
      <div class="b grid grid-2">
        <div class="field">
          <label>Name</label>
          <input id="ag_name" type="text" placeholder="e.g., Juan Dela Cruz"/>
        </div>
        <div class="field">
          <label>Mobile No.</label>
          <input id="ag_mobile" type="text" placeholder="e.g., +63 912 345 6789"/>
        </div>
        <div class="field">
          <label>Position</label>
          <input id="ag_role" type="text" placeholder="e.g., Property Consultant"/>
        </div>
        <div></div>
      </div>
    </section>

  </div>

<script>
// ---------- Helpers ----------
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));
const parseMoney = v => {
  const n = Number(String(v||'').replace(/[^0-9.\-]/g,''));
  return isFinite(n) ? n : 0;
};
const parsePercentOrAmount = (raw, base) => {
  if(!raw) return 0;
  const s = String(raw).trim();
  if(s.endsWith('%')){
    const p = parseFloat(s.slice(0,-1));
    if(!isFinite(p)) return 0;
    return base * (p/100);
  }
  // plain number = amount
  const amt = parseMoney(s);
  return amt>0? amt : 0;
};
const peso = (n)=>{
  if(!isFinite(n)) n=0;
  return '₱' + (Math.round(n*100)/100).toLocaleString('en-US', {minimumFractionDigits:2, maximumFractionDigits:2});
};

// ---------- Payment term toggle ----------
let termMode = 'spot';
$$('.pt').forEach(btn=>{
  btn.addEventListener('click',()=>{
    $$('.pt').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    termMode = btn.dataset.mode;
    // show/hide relevant term fields
    const showCls = {
      spot: ['term-spot','term-common'],
      split:['term-spot','term-split','term-common'],
      spread:['term-spread','term-common']
    };
    // hide all first
    $$('#termCard .term').forEach(e=>e.style.display='none');
    // show needed
    const show = showCls[termMode];
    $$('#termCard .term').forEach(e=>{
      const classes = e.className.split(' ');
      if(show.some(c=>classes.includes(c))){ e.style.display='flex'; }
    });
  });
});
// init visibility
document.querySelector('.pt.active').click();

// ---------- Compute Flow ----------
const computeAll = ()=>{
  // Project details
  const PD = {
    project: $('#pd_project').value.trim(),
    location: $('#pd_location').value.trim(),
    unit: $('#pd_unit').value.trim(),
    view: $('#pd_view').value.trim(),
    ref: $('#pd_ref').value.trim(),
    parking: $('#pd_parking').value.trim(),
  };

  // Pricing & Discounts (successive)
  let listPrice = parseMoney($('#price_list').value);
  let net = listPrice;
  const d1 = parsePercentOrAmount($('#disc1').value, net); net -= d1;
  const d2 = parsePercentOrAmount($('#disc2').value, net); net -= d2;
  const d3 = parsePercentOrAmount($('#disc3').value, net); net -= d3;
  const d4 = parsePercentOrAmount($('#disc4').value, net); net -= d4;
  const nlp = Math.max(0, net); // Net List Price
  const otherPct = parseFloat($('#other_pct').value)||0;
  const otherAmt = nlp * (otherPct/100);
  // VAT rule: NLP ≤ 3.6M → 0 else 12% of NLP
  const VAT_RATE = (nlp <= 3600000) ? 0 : 0.12;
  const vatAmt = nlp * VAT_RATE;
  const TAP = nlp + otherAmt + vatAmt;

  // Payment term inputs
  const dpPct = parseFloat($('#dp_pct').value)||0;
  const rf = parseMoney($('#rf_amt').value);
  const eqPct = parseFloat($('#eq_pct').value)||0;
  const eqMonths = Math.max(0, parseInt($('#eq_months').value||'0',10));

  let dpAmt = 0, netDp = 0, eqAmt = 0, monthlyEq = 0, remBal = 0;

  if(termMode==='spot'){
    dpAmt = TAP * (dpPct/100);
    netDp = dpAmt - rf;
    eqAmt = 0;
    monthlyEq = 0;
    remBal = Math.max(0, TAP - dpAmt);
  } else if(termMode==='split'){
    dpAmt = TAP * (dpPct/100);
    netDp = dpAmt - rf;
    eqAmt = TAP * (eqPct/100);
    monthlyEq = eqMonths>0 ? (eqAmt/eqMonths) : 0;
    remBal = Math.max(0, TAP - dpAmt - eqAmt);
  } else { // spread
    dpAmt = 0;
    netDp = 0; // no lump-sum DP
    eqAmt = TAP * (eqPct/100);
    monthlyEq = eqMonths>0 ? (eqAmt/eqMonths) : 0;
    // Often RF is deducted against equity collection; we won't net it here in summary
    remBal = Math.max(0, TAP - eqAmt);
  }

  // Bank amortization
  const rate = (parseFloat($('#bank_rate').value)||0)/100;
  const months = y=> y*12;
  const pmt = (P, r, n)=>{
    if(P<=0 || r<=0 || n<=0) return 0;
    const i = r/12;
    return P * i / (1 - Math.pow(1+i, -n));
  };
  const bank = {
    loanable: remBal,
    y5:   pmt(remBal, rate, months(5)),
    y10:  pmt(remBal, rate, months(10)),
    y15:  pmt(remBal, rate, months(15)),
    y20:  pmt(remBal, rate, months(20)),
    rate: rate*100
  };

  // ---------- Build SUMMARY ----------
  const kv = (label, value, highlight=false)=>{
    if(value===null || value===undefined) return '';
    return `<div class="kv${(highlight?' highlight':'')}"><b>${label}</b><em>${value}</em></div>`;
  };
  // Project
  const projGrid = $('#sum_project');
  projGrid.innerHTML = [
    PD.project ? kv('Project', PD.project) : '',
    PD.location ? kv('Location', PD.location) : '',
    PD.unit ? kv('Unit Type', PD.unit) : '',
    PD.view ? kv('View', PD.view) : '',
    PD.ref ? kv('Tower / Unit No.', PD.ref) : '',
    PD.parking ? kv('Parking', PD.parking) : ''
  ].join('');

  // Quotation
  const quote = [];
  quote.push(kv('List Price', peso(listPrice)));
  if(d1>0) quote.push(kv('Standard Discount', '- ' + peso(d1), true));
  if(d2>0) quote.push(kv('Special Discount',  '- ' + peso(d2), true));
  if(d3>0) quote.push(kv('Additional Discount','- ' + peso(d3), true));
  if(d4>0) quote.push(kv('Rebate',             '- ' + peso(d4), true));
  quote.push(kv('Net List Price', peso(nlp)));

  if(otherAmt>0) quote.push(kv('Other Charges', peso(otherAmt)));
  quote.push(kv('VAT', peso(vatAmt))); // still show even if 0
  quote.push(kv('TOTAL AMOUNT PAYABLE', '<b>'+peso(TAP)+'</b>'));
  $('#sum_quote').innerHTML = quote.join('');

  // Payment term (summary)
  const term = [];
  if(termMode==='spot'){
    if(dpAmt>0) term.push(kv('Downpayment', peso(dpAmt)));
    if(rf>0)    term.push(kv('Reservation Fee', '- ' + peso(rf), true));
    if(dpAmt>0) term.push(kv('Net Downpayment', peso(netDp)));
    term.push(kv('Remaining Balance', '<b>'+peso(remBal)+'</b>'));
  }else if(termMode==='split'){
    if(dpAmt>0) term.push(kv('Downpayment', peso(dpAmt)));
    if(rf>0)    term.push(kv('Reservation Fee', '- ' + peso(rf), true));
    if(dpAmt>0) term.push(kv('Net Downpayment', peso(netDp)));
    if(eqAmt>0) term.push(kv('Downpayment (Equity)', peso(eqAmt)));
    if(eqMonths>0) term.push(kv('Monthly Amortization', peso(monthlyEq) + `  (${eqMonths} mos)`, true));
    term.push(kv('Remaining Balance', '<b>'+peso(remBal)+'</b>'));
  }else{
    if(rf>0)    term.push(kv('Reservation Fee', '- ' + peso(rf), true));
    if(eqAmt>0) term.push(kv('Downpayment (Equity)', peso(eqAmt)));
    if(eqMonths>0) term.push(kv('Monthly Amortization', peso(monthlyEq) + `  (${eqMonths} mos)`, true));
    term.push(kv('Remaining Balance', '<b>'+peso(remBal)+'</b>'));
  }
  $('#sum_term').innerHTML = term.join('');

  // Bank
  const bankRows = [];
  bankRows.push(kv('Interest Rate', (bank.rate||0).toFixed(4) + '%'));
  bankRows.push(kv('Loanable Amount', peso(bank.loanable)));
  bankRows.push(kv('5 yrs Est. Amortization',  peso(bank.y5)));
  bankRows.push(kv('10 yrs Est. Amortization', peso(bank.y10)));
  bankRows.push(kv('15 yrs Est. Amortization', peso(bank.y15)));
  bankRows.push(kv('20 yrs Est. Amortization', peso(bank.y20)));
  $('#sum_bank').innerHTML = bankRows.join('');

  // Agent
  const agentRows = [];
  const ag = {
    name: $('#ag_name').value.trim(),
    mob: $('#ag_mobile').value.trim(),
    role: $('#ag_role').value.trim()
  };
  if(ag.name) agentRows.push(kv('Name', ag.name));
  if(ag.mob)  agentRows.push(kv('Mobile', ag.mob));
  if(ag.role) agentRows.push(kv('Position', ag.role));
  $('#sum_agent').innerHTML = agentRows.join('');

  // Switch to summary view
  document.body.classList.add('is-summary');
  window.scrollTo({top:0, behavior:'smooth'});
};

// ---------- Buttons ----------
$('#btnCompute').addEventListener('click', computeAll);
$('#btnBack').addEventListener('click', ()=>{
  document.body.classList.remove('is-summary');
  window.scrollTo({top:0, behavior:'smooth'});
});
$('#btnReset').addEventListener('click', ()=>{
  document.querySelectorAll('input').forEach(i=>{
    if(i.id==='vat_info') return;
    i.value='';
  });
  // reset term to spot
  document.querySelector('.pt[data-mode="spot"]').click();
});

// Save as PDF (print summary only)
$('#btnPDF').addEventListener('click', ()=>{
  window.print();
});

</script>
</body>
</html>
